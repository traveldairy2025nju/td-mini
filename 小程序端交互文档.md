# 旅游日记平台微信小程序交互文档

## 一、概述

本文档详细描述旅游日记平台微信小程序的用户交互流程、界面元素交互方式以及状态流转，为开发和测试提供参考。

## 二、全局交互元素

### 2.1 自定义TabBar

**位置**：页面底部固定展示
**组成元素**：
- 首页图标：点击跳转至首页
- 中间大号加号按钮：点击创建新游记
- 我的图标：点击跳转至我的页面

**交互规则**：
1. 当前选中的图标呈现主题色，未选中的图标为灰色
2. 加号按钮有轻微弹起效果，背景为次要主题色
3. 点击加号按钮时，若未登录，弹出登录提示对话框；若已登录，直接跳转至创建游记页面
4. TabBar跟随用户主题设置动态变化颜色

**状态变化**：
- 页面切换时自动更新选中状态
- 登录状态影响加号按钮的行为

### 2.2 导航栏

**位置**：页面顶部
**组成元素**：
- 返回按钮（非TabBar页面）
- 页面标题
- 可选的右侧功能按钮（如设置、删除等）

**交互规则**：
1. 点击返回按钮返回上一页
2. 标题居中展示当前页面名称
3. 右侧功能按钮根据页面不同展示不同的功能

### 2.3 全局状态提示

**组成元素**：
- 加载提示：页面加载或操作执行时显示的加载动画
- 结果提示：操作成功或失败时的提示框
- 确认对话框：需要用户确认的操作弹窗

**交互规则**：
1. 加载提示在网络请求进行时展示，请求完成后自动消失
2. 结果提示显示简短信息，支持成功（绿色对勾）和失败（红色感叹号）两种样式
3. 确认对话框包含标题、内容、确认和取消按钮，用户必须点击按钮后对话框才会关闭

### 2.4 主题色效果

**应用范围**：
- 按钮主色
- 选中状态标志
- 强调文本
- TabBar选中图标

**交互规则**：
1. 所有主题色元素根据用户主题设置实时变化
2. 用户可在设置页面随时更改主题

## 三、页面交互流程

### 3.1 登录注册流程

#### 3.1.1 登录页面

**入口**：
- 启动未登录状态的小程序访问需登录的功能
- 点击"我的"页面中的"登录"按钮
- 会话过期后自动跳转

**界面元素**：
- 用户名输入框
- 密码输入框（带眼睛图标可切换明文/密文）
- 登录按钮
- 注册入口文字链接

**交互流程**：
1. 用户填写用户名和密码
2. 点击登录按钮，显示加载状态
3. 登录成功：返回上一页或首页，显示成功提示
4. 登录失败：留在当前页，显示错误提示
5. 点击注册链接跳转至注册页面

**校验规则**：
- 用户名和密码不能为空
- 输入时实时检查格式，不符合规则时显示提示
- 登录失败时在相应字段下显示错误消息

#### 3.1.2 注册页面

**入口**：
- 登录页面的注册链接

**界面元素**：
- 用户名输入框
- 密码输入框
- 确认密码输入框
- 昵称输入框
- 头像上传按钮（可选）
- 注册按钮
- 返回登录链接

**交互流程**：
1. 用户填写各字段信息
2. 点击头像上传按钮可选择照片
3. 点击注册按钮，显示加载状态
4. 注册成功：自动登录并跳转至首页
5. 注册失败：留在当前页，显示错误提示
6. 点击返回登录链接回到登录页面

**校验规则**：
- 用户名：5-20个字符，只允许字母、数字和下划线
- 密码：8-20个字符，包含字母和数字
- 确认密码：必须与密码一致
- 昵称：2-10个字符
- 头像：文件大小不超过2MB

### 3.2 首页交互

**入口**：
- TabBar首页图标
- 小程序启动默认页面

**界面元素**：
- 顶部搜索框
- 标签页切换按钮（发现/附近）
- 瀑布流游记列表
- 下拉刷新区域
- 加载更多区域

**交互流程**：
1. 进入页面默认加载"发现"标签的游记列表
2. 点击标签页按钮切换不同内容
   - "发现"：展示热门游记
   - "附近"：展示用户周边游记，需要获取位置
3. 下拉页面触发刷新，更新列表内容
4. 滑动到底部自动加载更多内容
5. 点击搜索框跳转至搜索页
6. 点击游记卡片跳转至游记详情页

**特殊状态**：
- 首次进入"附近"标签时，若未授权位置权限，弹出授权请求
- 位置获取失败：显示错误提示和重试按钮
- 无游记数据：显示空状态提示
- 网络错误：显示错误提示和重试按钮

### 3.3 游记详情页交互

**入口**：
- 首页游记列表项点击
- 我的游记列表项点击
- 搜索结果点击

**界面元素**：
- 顶部作者信息（头像、昵称）
- 图片轮播组件
- 视频播放器（如有）
- 标题和内容区域
- 位置信息卡片
- 底部操作栏（点赞、收藏、分享）
- 编辑/删除按钮（仅自己的游记且未审核通过）

**交互流程**：
1. 进入页面加载游记详情数据
2. 滑动轮播查看所有图片，点击图片可全屏预览
3. 点击视频可播放/暂停
4. 点击位置信息卡片打开小程序内置地图
5. 底部操作栏互动：
   - 点赞：切换点赞状态
   - 收藏：切换收藏状态
   - 分享：调起微信分享
6. 若为自己的游记且未审核通过：
   - 点击编辑按钮进入编辑页面
   - 点击删除按钮弹出确认对话框，确认后删除
7. 下拉关闭详情页返回上一页

**特殊状态**：
- 图片加载失败：显示占位图
- 视频加载失败：显示错误提示
- 游记已删除：显示相应提示并自动返回
- 无权访问：显示无权限提示

### 3.4 创建/编辑游记页面

**入口**：
- TabBar中间加号按钮（创建）
- 游记详情页编辑按钮（编辑）

**界面元素**：
- 标题输入框
- 内容多行文本框
- 图片上传组件
- 视频上传按钮
- 位置选择组件
- 提交按钮
- 取消按钮

**交互流程**：
1. 进入页面：
   - 创建模式：显示空白表单
   - 编辑模式：加载已有内容
2. 填写标题和内容
3. 图片上传：
   - 点击添加图片按钮选择照片
   - 长按已上传图片可删除
   - 拖动调整图片顺序
4. 视频上传：
   - 点击添加视频按钮选择视频
   - 点击已上传视频预览
   - 点击删除图标移除视频
5. 位置选择：
   - 点击位置按钮打开地图选点
   - 选择位置后显示位置名称
   - 点击删除图标清除位置
6. 点击提交按钮：
   - 执行表单验证
   - 显示上传进度
   - 成功后返回上一页并显示成功提示
7. 点击取消按钮：
   - 若有内容变更，弹出确认对话框
   - 确认后放弃更改并返回

**校验规则**：
- 标题：必填，1-30个字符
- 内容：必填，最多2000字
- 图片：必须上传至少1张，最多9张
- 视频：可选，大小不超过50MB，长度不超过3分钟
- 位置：可选

### 3.5 我的页面交互

**入口**：
- TabBar我的图标

**界面元素**：
- 顶部用户信息卡片（头像、昵称）
- 设置按钮
- 标签页切换（我的游记/收藏）
- 状态筛选器（全部/待审核/已通过/已拒绝）
- 游记列表（瀑布流）
- 未登录提示（未登录状态）

**交互流程**：
1. 进入页面：
   - 已登录：显示用户信息和游记列表
   - 未登录：显示登录提示
2. 已登录状态交互：
   - 点击头像：选择并上传新头像
   - 点击昵称：进入昵称编辑页面
   - 点击设置：进入设置页面
   - 切换标签页查看不同列表
   - 在"我的游记"标签下可使用状态筛选
   - 点击列表项进入详情页
3. 未登录状态交互：
   - 点击登录按钮前往登录页面

**特殊状态**：
- 头像上传中：显示上传进度
- 无游记数据：显示空状态提示
- 网络错误：显示错误提示和重试按钮

### 3.6 搜索页面交互

**入口**：
- 首页顶部搜索框

**界面元素**：
- 顶部搜索输入框（带清除按钮）
- 搜索历史记录
- 热门搜索标签
- 搜索结果列表
- 取消按钮

**交互流程**：
1. 进入页面显示搜索历史和热门搜索
2. 输入关键词：
   - 实时显示清除按钮
   - 回车或点击搜索按钮执行搜索
3. 搜索执行后：
   - 显示加载状态
   - 展示结果列表
   - 自动保存搜索记录
4. 交互操作：
   - 点击历史记录/热门标签直接执行搜索
   - 长按历史记录项可删除
   - 点击"清空历史"删除所有历史
   - 点击结果项进入详情页
   - 点击取消返回首页

**特殊状态**：
- 搜索中：显示加载动画
- 无搜索结果：显示空结果提示
- 网络错误：显示错误提示和重试按钮

### 3.7 设置页面交互

**入口**：
- 我的页面设置按钮

**界面元素**：
- 主题设置选项
- 自定义主题按钮
- 清除缓存选项
- 关于我们选项
- 退出登录按钮

**交互流程**：
1. 点击主题设置进入主题选择页
2. 点击自定义主题进入主题定制页
3. 点击清除缓存弹出确认对话框，确认后清除
4. 点击关于我们查看应用信息
5. 点击退出登录弹出确认对话框，确认后退出并返回首页

**特殊状态**：
- 缓存清除中：显示进度提示
- 退出登录中：显示加载状态

### 3.8 主题选择/定制页面

**入口**：
- 设置页面主题相关选项

**界面元素**：
- 预设主题列表（主题选择页）
- 颜色选择器（自定义主题页）
- 预览区域
- 确认按钮

**交互流程**：
1. 主题选择页：
   - 点击预设主题卡片选中
   - 选中状态显示对勾标记
   - 点击确认应用选中主题
2. 自定义主题页：
   - 调整颜色选择器选择主色调
   - 预览区域实时显示效果
   - 点击确认应用自定义主题

**特殊状态**：
- 应用主题中：显示加载状态
- 保存失败：显示错误提示

## 四、状态管理与数据流转

### 4.1 登录状态管理

**登录状态存储**：
- Token保存在本地存储中
- 用户信息保存在全局状态中

**状态检查时机**：
- 小程序启动时
- 访问需要权限的页面前
- TabBar加号按钮点击时
- 需要用户信息的操作前

**状态流转**：
1. 未登录 → 登录中 → 登录成功/失败
2. 登录成功后自动获取用户信息
3. Token过期自动转为未登录状态

### 4.2 游记数据流转

**数据缓存策略**：
- 首页游记列表缓存在内存中
- 下拉刷新时更新缓存
- 切换标签页保留各自缓存

**状态流转**：
1. 创建游记：草稿 → 提交中 → 待审核状态
2. 编辑游记：待审核 → 修改中 → 待审核状态
3. 游记状态：待审核 → 已通过/已拒绝

### 4.3 主题管理

**主题状态存储**：
- 主题设置保存在本地存储中
- 全局状态管理主题对象

**主题应用时机**：
- 小程序启动时
- 切换主题后
- 自定义主题保存后

**全局监听**：
- 使用事件中心通知所有页面主题变化
- 组件响应主题变化自动更新样式

## 五、交互注意事项

### 5.1 性能优化

**延迟加载策略**：
- 图片使用懒加载，进入视口才加载
- 视频使用封面图预加载，点击才加载视频内容
- 瀑布流使用虚拟列表，只渲染可视区域

**节流与防抖**：
- 搜索输入使用防抖，停止输入300ms后才执行搜索
- 下拉刷新和加载更多使用节流，防止频繁触发

### 5.2 错误处理

**网络错误**：
- 请求超时：显示超时提示，提供重试按钮
- 服务器错误：显示服务异常提示，提供重试按钮
- 无网络连接：显示网络连接提示，自动重连

**权限错误**：
- 未登录：引导用户登录
- 无权限：显示无权限提示
- 资源不存在：显示相应提示并返回上一页

### 5.3 用户体验优化

**反馈机制**：
- 所有操作按钮有点击反馈效果
- 长时操作显示进度指示器
- 操作结果给予明确成功/失败提示

**引导提示**：
- 首次使用特定功能时展示引导提示
- 空状态提供明确的下一步操作指引
- 错误状态提供清晰的解决方案

**手势支持**：
- 图片支持多手势操作（缩放、拖动）
- 游记详情页支持下拉返回
- 列表支持上拉加载更多，下拉刷新

### 5.4 兼容性处理

**设备适配**：
- 适配不同屏幕尺寸，内容自适应布局
- 适配刘海屏、全面屏等特殊屏幕
- 考虑低性能设备，优化动画和渲染

**版本兼容**：
- 使用基础库兼容性检查
- 高级特性使用前检查API可用性
- 关键功能提供降级方案

## 六、交互流程图

### 6.1 登录注册流程
```
┌─────────┐    ┌──────────┐    ┌──────────┐
│  未登录  │───>│  登录页面 │<───│ 注册页面  │
└─────┬───┘    └─────┬────┘    └─────┬────┘
      │              │               │
      │         ┌────┴───┐      ┌───┴────┐
      └────────>│ 登录成功 │<─────│注册成功 │
                └────┬───┘      └────────┘
                     │
               ┌─────┴─────┐
               │  应用首页  │
               └───────────┘
```

### 6.2 游记创建流程
```
┌─────────┐    ┌──────────┐    ┌──────────┐
│  首页    │    │ 创建游记页 │    │上传多媒体 │
│  TabBar  │───>│ 填写内容  │───>│选择位置   │
└─────────┘    └─────┬────┘    └─────┬────┘
                     │               │
                ┌────┴───────────────┴───┐
                │        提交游记         │
                └────────────┬───────────┘
                             │
                      ┌──────┴───────┐
                      │ 返回我的游记页 │
                      └──────────────┘
```

### 6.3 主题设置流程
```
┌─────────┐    ┌──────────┐    ┌──────────┐
│ 我的页面 │───>│  设置页面 │───>│ 主题选择页 │
└─────────┘    └─────┬────┘    └─────┬────┘
                     │               │
                     │         ┌─────┴─────┐
                     │         │自定义主题页 │
                     │         └─────┬─────┘
                     │               │
                ┌────┴───────────────┴───┐
                │     应用新主题到全局    │
                └──────────────────────┘
```

## 七、附录

### 7.1 交互规范参考

**字体规范**：
- 标题：18px, 粗体
- 副标题：16px, 半粗体
- 正文：14px, 常规
- 辅助文本：12px, 常规

**颜色规范**：
- 主题色：由用户主题设置决定
- 背景色：#ffffff（白色）
- 文本主色：#333333（深灰）
- 文本副色：#666666（中灰）
- 提示文本：#999999（浅灰）
- 分割线：#eeeeee（极浅灰）
- 错误色：#ff4d4f（红色）
- 成功色：#52c41a（绿色）

**间距规范**：
- 页面边距：16px
- 元素间距：12px
- 内容内边距：12px
- 卡片圆角：8px

**动画规范**：
- 转场动画：300ms ease-in-out
- 按钮反馈：100ms
- 淡入淡出：200ms
- 加载动画：循环旋转600ms

### 7.2 常见交互反馈

**操作反馈**：
- 点击过渡：透明度变化或轻微缩放
- 按钮加载：替换为加载图标
- 表单提交：禁用按钮并显示加载状态
- 下拉刷新：顶部显示加载动画

**结果反馈**：
- 操作成功：轻提示带对勾图标
- 操作失败：轻提示带感叹号图标
- 需注意信息：底部滑出通知
- 严重错误：模态对话框展示详情 