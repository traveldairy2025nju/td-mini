# 旅游日记平台微信小程序设计文档

## 一、项目概述

### 1.1 项目名称
旅游日记平台微信小程序

### 1.2 项目背景
"旅游日记平台"是一个面向C端用户的社交分享平台，旨在让用户记录和分享旅行经历，浏览他人的游记。微信小程序端作为移动端的主要入口，需提供良好的用户体验，支持用户注册登录、游记创建与管理、浏览与搜索等功能。

### 1.3 设计目标
- 实现用户友好的界面，符合微信小程序的交互规范。
- 支持核心功能：用户注册/登录、游记创建/编辑/删除、游记浏览/搜索。
- 确保高性能和稳定性，优化小程序加载速度和响应时间。
- 与后端接口无缝对接，处理多媒体上传和数据分页加载。
- 支持自定义主题和个性化设置，提升用户体验。
- 遵循项目评分标准，注重用户体验（UI/UX）和代码质量。

## 二、功能模块

根据项目要求和 OpenAPI 文档，微信小程序端的功能模块分为以下几部分：

### 2.1 用户模块
- **注册**：用户通过用户名、密码、昵称和可选头像进行注册。
- **登录**：支持用户名和密码登录，返回 JWT Token 用于后续请求认证。
- **个人资料**：查看和更新用户昵称、头像。
- **我的游记**：查看自己创建的游记列表，支持按状态（待审核、已通过、已拒绝）过滤。
- **收藏管理**：查看已收藏的游记列表。

### 2.2 游记模块
- **游记列表**：通过两个标签页展示"发现"和"附近"的游记，支持分页加载、关键词搜索和按地理位置筛选。
- **游记详情**：查看游记的标题、内容、图片、视频和位置信息。
- **创建游记**：用户可上传标题、内容、图片（必填）、视频（可选）和位置信息。
- **编辑游记**：支持编辑未审核通过的游记。
- **删除游记**：用户可删除自己创建的游记。

### 2.3 主题设置模块
- **主题选择**：用户可以选择预设主题或自定义主题颜色。
- **个性化设置**：支持界面风格的个性化配置。

## 三、页面设计

### 3.1 页面结构
小程序采用自定义 TabBar 导航，包含以下主页面：
1. **首页**：展示热门游记列表，支持"发现"和"附近"两个标签页。
2. **创建游记**：中间的加号按钮，快速创建新游记。
3. **我的**：展示用户资料、我的游记和收藏的游记。

### 3.2 页面详情

#### 3.2.1 首页
- **功能**：
  - "发现"标签页：展示热门游记列表（瀑布流布局，包含标题、图片、位置信息等）。
  - "附近"标签页：展示用户附近的游记，需要获取用户位置。
  - 支持关键词搜索（调用 `/api/diaries` 的 `keyword` 参数）。
  - 分页加载（通过 `page` 和 `limit` 参数实现）。
- **UI 元素**：
  - 顶部搜索栏。
  - 标签切换（发现/附近）。
  - 瀑布流游记列表。
  - 无数据/错误提示界面。
- **交互**：
  - 点击游记卡片跳转至游记详情页。
  - 点击搜索栏跳转至搜索页面。
  - 滑动到底部加载更多。

#### 3.2.2 我的
- **功能**：
  - 展示用户资料（头像、昵称）。
  - 我的游记/收藏标签页切换。
  - 游记状态过滤（全部、待审核、已通过、已拒绝）。
  - 设置入口。
- **UI 元素**：
  - 用户头像和昵称区域。
  - 设置按钮。
  - 标签切换组件（我的游记/收藏）。
  - 状态过滤组件（仅在"我的游记"标签下显示）。
  - 游记列表（瀑布流布局）。
  - 未登录提示界面。
- **交互**：
  - 点击头像可更新头像。
  - 点击昵称可编辑昵称。
  - 点击设置按钮进入设置页面。
  - 点击游记进入详情页面。
  - 未登录状态显示登录按钮。

#### 3.2.3 游记详情
- **功能**：
  - 展示游记的标题、内容、图片、视频、位置信息和创建者信息。
  - 支持未审核通过的游记编辑（仅限创建者）。
- **UI 元素**：
  - 顶部标题和创建者信息。
  - 图片轮播组件（支持多张图片）。
  - 视频播放组件（若有视频）。
  - 内容文本展示区域。
  - 位置信息（可点击查看地图）。
  - 编辑/删除按钮（仅限创建者且未审核通过）。
- **交互**：
  - 图片支持点击放大预览。
  - 视频支持播放/暂停。
  - 位置信息调用 `wx.openLocation` 显示地图。
  - 编辑跳转至游记编辑页。

#### 3.2.4 游记编辑/创建
- **功能**：
  - 创建或编辑游记，包含标题、内容、图片、视频和位置信息。
  - 支持多媒体上传（图片必填，视频可选）。
- **UI 元素**：
  - 标题输入框。
  - 内容富文本编辑器（或多行文本框）。
  - 图片上传组件（支持多张图片预览和删除）。
  - 视频上传组件（支持预览）。
  - 位置选择组件（结合 `wx.chooseLocation`）。
  - 提交按钮。
- **交互**：
  - 图片上传调用 `wx.chooseImage`，支持预览和删除。
  - 视频上传调用 `wx.chooseVideo`。
  - 位置选择调用 `wx.chooseLocation`，返回经纬度和名称。
  - 提交时校验必填字段，调用 `/api/diaries` 或 `/api/diaries/{id}`。

#### 3.2.5 设置
- **功能**：
  - 主题选择和自定义。
  - 退出登录。
  - 其他个性化设置。
- **UI 元素**：
  - 主题选择卡片。
  - 自定义主题按钮。
  - 退出登录按钮。
- **交互**：
  - 点击主题卡片切换主题。
  - 自定义主题跳转至主题定制页面。
  - 退出登录清空本地存储，跳转至登录页。

### 3.3 页面导航
- **TabBar**：
  - 首页（图标：主页）
  - 中间的创建游记按钮（图标：加号）
  - 我的（图标：用户）
- **自定义 TabBar 特点**：
  - 使用 SVG 图标，根据主题色动态变色。
  - 中间凸起的大按钮用于创建游记。
  - 根据用户登录状态动态处理创建游记按钮的行为。

## 四、接口对接

### 4.1 用户相关接口
- **注册**：`POST /api/users/register`
  - 参数：`username`, `password`, `nickname`, `avatar`（multipart/form-data）
  - 实现：使用 `wx.uploadFile` 上传头像，处理返回的 `token` 和用户信息。
- **登录**：`POST /api/users/login`
  - 参数：`username`, `password`（application/json）
  - 实现：使用 `wx.request` 发送登录请求，存储 `token` 至 `wx.setStorageSync`。
- **获取个人资料**：`GET /api/users/profile`
  - 实现：携带 `token` 在 header 中，获取用户信息并更新页面。
- **更新头像**：`PUT /api/users/avatar`
  - 参数：`avatar`（multipart/form-data）
  - 实现：使用 `wx.uploadFile` 上传新头像。
- **更新昵称**：`PUT /api/users/nickname`
  - 参数：`nickname`（application/json）
  - 实现：使用 `wx.request` 更新昵称。

### 4.2 游记相关接口
- **获取已批准游记列表**：`GET /api/diaries`
  - 参数：`page`, `limit`, `keyword`, `lat`, `lng`, `distance`
  - 实现：支持分页加载，结合 `wx.getLocation` 获取用户位置。
- **创建游记**：`POST /api/diaries`
  - 参数：`title`, `content`, `images`, `video`, `location`（multipart/form-data）
  - 实现：使用 `wx.uploadFile` 上传图片和视频，`location` 格式化为 GeoJSON。
- **获取游记详情**：`GET /api/diaries/{id}`
  - 实现：展示详情页内容，处理图片和视频渲染。
- **更新游记**：`PUT /api/diaries/{id}`
  - 参数：同创建游记
  - 实现：仅限未审核通过的游记，复用创建逻辑。
- **删除游记**：`DELETE /api/diaries/{id}`
  - 实现：弹出确认弹窗后调用接口。
- **获取我的游记**：`GET /api/diaries/user/me`
  - 参数：`page`, `limit`, `status`
  - 实现：支持状态过滤，分页加载。
- **获取收藏的游记**：`GET /api/diaries/favorites`
  - 实现：获取用户收藏的游记列表。
- **收藏/取消收藏游记**：`POST /api/diaries/{id}/favorite`、`DELETE /api/diaries/{id}/favorite`
  - 实现：收藏或取消收藏游记。

### 4.3 接口调用注意事项
- **认证**：所有需要授权的接口需在 header 中携带 `Authorization: Bearer {token}`。
- **错误处理**：处理 401（未授权）、404（资源未找到）等状态码，提示用户重新登录或显示错误信息。
- **多媒体上传**：使用 `wx.uploadFile` 上传图片和视频，确保文件大小符合后端限制。
- **分页**：通过 `page` 和 `limit` 参数实现列表分页，监听页面滚动触发加载更多。
- **位置处理**：将 `wx.chooseLocation` 返回的经纬度格式化为 GeoJSON 格式。

## 五、技术选型

### 5.1 开发框架
- **Taro**：使用 Taro 3.x 框架进行开发，支持React语法，提供跨端开发能力。
- **React**：使用 React 函数式组件和Hooks开发页面和组件。
- **TypeScript**：使用 TypeScript 进行类型检查，提高代码质量和开发效率。

### 5.2 状态管理
- **Zustand**：轻量级状态管理库，用于管理全局状态如用户信息和主题设置。
- **React Hooks**：使用 useState、useEffect 等 Hooks 管理组件内部状态。
- **Context API**：在必要时使用 Context 提供主题等全局配置。

### 5.3 网络请求
- **Taro.request**：处理 JSON 数据请求。
- **Taro.uploadFile**：处理图片和视频上传。
- **请求封装**：封装通用的请求函数，统一处理 `token`、错误提示和加载状态。

### 5.4 UI 组件
- **自定义组件**：开发瀑布流布局、游记卡片、上传组件等。
- **Taro UI**：引入部分Taro UI组件，如按钮、输入框等。
- **自定义TabBar**：开发支持主题切换和动态图标的自定义TabBar。

### 5.5 其他工具
- **自定义主题系统**：支持多种预设主题和自定义主题色。
- **SVG处理**：使用SVG图标并支持动态着色。
- **ESLint/Prettier**：确保代码规范性和一致的格式。
- **Git**：代码版本管理，提交至公开仓库（如 GitHub）。

## 六、开发注意事项

### 6.1 用户体验优化
- **加载性能**：使用懒加载优化图片和视频加载，减少首屏加载时间。
- **瀑布流布局**：采用瀑布流布局展示游记列表，提升视觉体验。
- **交互反馈**：为按钮点击、表单提交等操作添加加载动画和提示。
- **适配性**：确保小程序在不同设备（iOS、Android）和屏幕尺寸下正常显示。
- **主题系统**：支持用户选择和自定义主题，全局一致应用主题色。

### 6.2 代码质量
- **模块化**：将公共逻辑（如请求封装、工具函数）抽取为独立模块。
- **自定义Hooks**：封装业务逻辑为可复用的自定义Hooks。
- **注释**：为关键函数和组件添加注释，说明功能和参数。
- **错误处理**：统一处理接口错误，显示友好提示。
- **代码规范**：遵循 ESLint 规则，保持一致的代码风格。

### 6.3 安全性和权限
- **Token 管理**：将 `token` 存储在 `wx.setStorageSync` 中，设置过期时间，401 错误时跳转登录页。
- **数据校验**：在提交游记前校验必填字段，防止无效请求。
- **路由权限**：对需要登录的页面进行权限校验，未登录时引导用户登录。

### 6.4 项目提交
- **代码仓库**：提交至公开 Git 仓库（如 GitHub），包含清晰的 README 说明项目启动方式。
- **文档**：提供项目说明文档，描述功能实现和技术选型。
- **测试**：在提交前测试所有功能，确保无明显 Bug。

## 七、评分标准实现

根据项目文档的评分标准，以下为实现重点：
- **用户体验（10 分）**：
  - 优化 UI 布局，实现瀑布流展示游记。
  - 支持主题定制，提升用户个性化体验。
  - 提供流畅的交互体验，如搜索、图片预览、视频播放。
  - 确保小程序加载速度快，首屏渲染时间短。
- **代码质量（10 分）**：
  - 使用 TypeScript 提高代码类型安全性。
  - 遵循模块化开发，抽取公共组件和逻辑。
  - 使用 Zustand 管理全局状态，提高代码可维护性。
  - 确保代码可维护性和可扩展性。

## 八、附录

### 8.1 页面流程图
```
登录/注册 -> 首页(发现/附近) -> 游记详情
        -> 我的(游记/收藏) -> 游记详情/编辑
        -> 创建游记
        -> 设置 -> 主题选择/退出登录
```

### 8.2 接口清单
| 接口路径 | 方法 | 功能 | 角色 |
|----------|------|------|------|
| /api/users/register | POST | 用户注册 | 游客 |
| /api/users/login | POST | 用户登录 | 游客 |
| /api/users/profile | GET | 获取个人资料 | 用户 |
| /api/users/avatar | PUT | 更新头像 | 用户 |
| /api/users/nickname | PUT | 更新昵称 | 用户 |
| /api/diaries | GET | 获取已批准游记列表 | 所有 |
| /api/diaries | POST | 创建游记 | 用户 |
| /api/diaries/{id} | GET | 获取游记详情 | 所有 |
| /api/diaries/{id} | PUT | 更新游记 | 用户 |
| /api/diaries/{id} | DELETE | 删除游记 | 用户 |
| /api/diaries/user/me | GET | 获取我的游记 | 用户 |
| /api/diaries/favorites | GET | 获取收藏的游记 | 用户 |
| /api/diaries/{id}/favorite | POST | 收藏游记 | 用户 |
| /api/diaries/{id}/favorite | DELETE | 取消收藏游记 | 用户 |

### 8.3 技术栈总结
- 框架：Taro 3.x + React + TypeScript
- 状态管理：Zustand + React Hooks
- UI组件：自定义组件 + Taro UI
- 网络请求：Taro.request/Taro.uploadFile
- 样式：SCSS
- 主题系统：自定义主题机制
- 代码管理：Git + ESLint/Prettier 